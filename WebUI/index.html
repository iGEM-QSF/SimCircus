<html>
<meta>
    <title>SimCircus WebUI</title>
    <link href="jquery-ui/jquery-ui.css" rel="stylesheet">
    <style type="text/css">
    #right, #left {
        height:700px;
        position: absolute;
        top:0;
    }
    #right {
        right:0;
    }
    #left {
        left:0;
    }

    img {
        height:30%;
    }

    #slider-right, #slider-left {
        height:70%;
        margin-left: auto;
        margin-right: auto;
    }
    </style>
</meta>
<body class="raphael">
    <div id="left">
        <img id="bulb-left" src="bulb.svg"/>
        <div id="slider-left"></div>
    </div>
    <div id="right">
        <img id="bulb-right" src="bulb.svg"/>
        <div id="slider-right"></div>
    </div>
    <div id="paper1"></div>
</body>
<script type="text/javascript" src="raphael-min.js"></script>
<script src="jquery-ui/external/jquery/jquery.js"></script>
<script src="jquery-ui/jquery-ui.js"></script>
<script type="text/javascript">
    /* Some helping functions to make arcs easier*/
    Raphael.fn.arc = function(startX, startY, endX, endY, radius1, radius2, angle) {
      var arcSVG = [radius1, radius2, angle, 0, 1, endX, endY].join(' ');
      return this.path('M'+startX+' '+startY + " a " + arcSVG);
    };

    Raphael.fn.circularArc = function(centerX, centerY, radius, startAngle, endAngle) {
      var startX = centerX+radius*Math.cos(startAngle*Math.PI/180);
      var startY = centerY+radius*Math.sin(startAngle*Math.PI/180);
      var endX = centerX+radius*Math.cos(endAngle*Math.PI/180);
      var endY = centerY+radius*Math.sin(endAngle*Math.PI/180);
      return this.arc(startX, startY, endX-startX, endY-startY, radius, radius, 0);
    };

    function setBlueLight(event, ui){
        var value = ui.value

        if (value < 0) {
            value = 0;
        }

        if (value > 100) {
            value = 100;
        }

        value = 100-value
        arcLeft.attr({
            stroke: "rgb("+(50+value).toString()+","+(50+value).toString()+","+(255-value).toString()+")"
        });
    }

    function setRedLight(event, ui){
        var value = ui.value

        if (value < 0) {
            value = 0;
        }

        if (value > 100) {
            value = 100;
        }

        value = 100-value
        arcRight.attr({
            stroke: "rgb("+(255-value).toString()+","+(50+value).toString()+","+(50+value).toString()+")"
        });
    }

    /* Init drawing area */
    var width = 1280;
    var height = 720;
    var stroke = 10;
    var fade = 0;
    var paper = Raphael("paper1", width, height);

    var arcRight = paper.circularArc(width/2,height/2,height/2-stroke,270,90).attr({
        "stroke-width":10,
        stroke: "rgb(250,0,0)"
    });
    var arcLeft = paper.circularArc(width/2,height/2,height/2-stroke,90,270).attr({
        "stroke-width":10,
        stroke: "rgb(50,50,255)"
    });

    function drawCircles() {
        var circleAmount = Math.floor(Math.random() * 6) + 4;

        var circleList = [];
        var centerX = width/2;
        var centerY = height/2;
        var radius = (height-stroke)/2;
        var distance = 0;
        var angle = 0;
        var size = 0;
        var tmp = 0;

        for (var i = 0; i < circleAmount; i ++) {
            size = 15+Math.random()*30;
            distance = Math.random()*radius-size-stroke;
            angle = Math.random()*2*Math.PI;
            tmp = paper.circle(centerX+Math.cos(angle)*distance, centerY+Math.sin(angle)*distance, size)
            if (overlap(tmp, circleList)){
                i --;
                tmp.remove()
            } else {
                circleList.push(tmp);
            }
        }
        return circleList;
    }

    function overlap(circ, list) {
        for (var i = 0; i < list.length; i++){
            if (_overlap(circ, list[i])){
                return true;
            }
        }
        return false;
    }
    function _overlap(circ1, circ2) {
        var attrs = ["cx", "cy", "r"];
        var c1 = circ1.attr(attrs);
        var c2 = circ2.attr(attrs);
        var dist = Math.sqrt(Math.pow(c1.cx - c2.cx ,2) + Math.pow(c1.cy - c2.cy, 2));
        return (dist < (c1.r + c2.r));
    }

    function setColonyColor(rgbString, circleList) {
        for (var i = 0; i < circleList.length; i++) {
            circleList[i].attr({
                fill: rgbString
            })
        }
    }

    function getLightIntensities() {
        return {
            blue: $("#slider-left").slider("value"),
            red: $("#slider-right").slider("value")
        };
    }

    /* Init UI */
    $("#slider-left").slider({
        max: 100,
        min: 0,
        orientation: "vertical",
        change: setBlueLight,
        value: 100,
        animate: "slow"
    });

    $("#slider-right").slider({
        max: 100,
        min: 0,
        orientation: "vertical",
        change: setRedLight,
        value: 100,
        animate: "slow"
    });

    var circleList = drawCircles();

</script>
</html>